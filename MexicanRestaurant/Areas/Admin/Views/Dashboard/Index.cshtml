@using MexicanRestaurant.WebUI.ViewModels
@model AdminDashboardViewModel

@{
    ViewData["Title"] = "Admin Dashboard";
    ViewData["MetaDescription"] = "Admin dashboard for the Mexican Restaurant application, providing an overview of key metrics and system status.";
}

<form method="get" class="row g-2 my-4">
    <div class="col-md-4">
        <label for="startDate" class="form-label text-success fw-bold">From Date</label>
        <input type="date" name="startDate" class="form-control" value="@Model.StartDate?.ToString("yyyy-MM-dd")" />
    </div>
    <div class="col-md-4">
        <label for="endDate" class="form-label text-success fw-bold">To Date</label>
        <input type="date" name="endDate" class="form-control" value="@Model.EndDate?.ToString("yyyy-MM-dd")" />
    </div>
    <div class="col-md-4 d-flex align-items-end">
        <button type="submit" class="btn btn-success w-100">🔍 Filter by Date</button>
    </div>
</form>

<div class="container">
    <h2 class="mb-4 text-center text-success">📊 Admin Dashboard</h2>

    <div class="row g-4">
        <div class="col-md-3 col-sm-6">
            <div class="card text-white bg-success h-100 shadow-sm">
                <div class="card-body text-center">
                    <h6 class="mb-1">Total Users</h6>
                    <h4 class="mb-0">@Model.TotalUsers</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="card text-white bg-primary h-100 shadow-sm">
                <div class="card-body text-center">
                    <h6 class="mb-1">Total Orders</h6>
                    <h4 class="mb-0">@Model.TotalOrders</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="card text-white bg-info h-100 shadow-sm">
                <div class="card-body text-center">
                    <h6 class="mb-1">Total Products</h6>
                    <h4 class="mb-0">@Model.TotalProducts</h4>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="card text-white bg-warning h-100 shadow-sm">
                <div class="card-body text-center">
                    <h6 class="mb-1">Total Revenue</h6>
                    <h4 class="mb-0">$@Model.TotalRevenue.ToString("N2")</h4>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-3" />

    <div class="row">
        <div class="col-lg-4">
            <h4 class="text-center mb-3">Top Selling Products</h4>
            @if (Model.TopProductNames != null && Model.TopProductSales != null)
            {
                <canvas id="topProductsChart" height="200"></canvas>
            }
            else
            {
                <p class="text-muted text-center">No data available for top products.</p>
            }
        </div>

        <div class="col-lg-4">
            <h4 class="text-center mb-3">Sales by Category</h4>
            @if (Model.CategorySales != null && Model.CategorySales.Any())
            {
                <canvas id="categoryChart" height="300"></canvas>
            }
        </div>

        <div class="col-lg-4">
            <h4 class="text-center mb-3">Revenue Timeline</h4>
            @if (Model.RevenueByDate != null && Model.RevenueByDate.Any())
            {   
                <canvas id="revenueChart" height="300"></canvas>
            }
            else
            {
                <p class="text-muted text-center">No revenue data to display.</p>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const topNames = @Html.Raw(Json.Serialize(Model.TopProductNames ?? new List<string>()));
        const topSales = @Html.Raw(Json.Serialize(Model.TopProductSales ?? new List<int>()));
        const revenueLabels = @Html.Raw(Json.Serialize(Model.RevenueByDate != null && Model.RevenueByDate.Any() ? Model.RevenueByDate.Keys.ToList() : new List<string>()));
        const revenueValues = @Html.Raw(Json.Serialize(Model.RevenueByDate != null && Model.RevenueByDate.Any() ? Model.RevenueByDate.Values.ToList() : new List<decimal>()));
        const categoryLabels = @Html.Raw(Json.Serialize(Model.CategorySales != null && Model.CategorySales.Any() ? Model.CategorySales.Keys.ToList() : new List<string>()));
        const categoryValues = @Html.Raw(Json.Serialize(Model.CategorySales != null && Model.CategorySales.Any() ? Model.CategorySales.Values.ToList() : new List<int>()));

        if (topNames.length > 0 && topSales.length > 0) {
            new Chart(document.getElementById("topProductsChart"), {
                type: 'doughnut',
                data: {
                    labels: topNames,
                    datasets: [{
                        label: 'Sales Count',
                        data: topSales,
                        backgroundColor: ['#198754', '#36A2EB', '#FFCE56', '#FF6384', '#FF9F40'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'Top Products' }
                    }
                }
            });
        }

        if (categoryLabels.length > 0 && categoryValues.length > 0) {
            new Chart(document.getElementById("categoryChart"), {
                type: 'pie',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryValues,
                        backgroundColor: ['#FFCE56', '#36A2EB', '#198754', '#FF6384', '#FF9F40'],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'Sales by Category' }
                    }
                }
            });
        }

        if (revenueLabels.length > 0 && revenueValues.length > 0) {
            new Chart(document.getElementById("revenueChart"), {
                type: 'line',
                data: {
                    labels: revenueLabels,
                    datasets: [{
                        label: 'Revenue ($)',
                        data: revenueValues,
                        fill: true,
                        borderColor: '#198754',
                        backgroundColor: 'rgba(25,135,84,0.2)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'Revenue Over Time' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Date' } },
                        y: { title: { display: true, text: 'Amount ($)' } }
                    }
                }
            });
        }
    </script>
}
